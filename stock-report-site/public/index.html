<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>市場報表中心</title>
    <style>
      :root { --bg:#0b1020; --panel:#121a2f; --text:#e6edf3; --muted:#9fb0c3; --line:#253252; --active:#3b82f6; --green:#22c55e; --red:#ef4444; }
      * { box-sizing: border-box; }
      body { margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; background:linear-gradient(180deg,#0b1020 0%,#0a1226 100%); color:var(--text); }
      .wrap { max-width:1200px; margin:0 auto; padding:20px; }
      h1 { margin:0 0 8px; }
      .sub { color:var(--muted); margin-bottom:14px; }
      .tabs { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
      .tab { border:1px solid var(--line); background:var(--panel); color:var(--text); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600; }
      .tab.active { border-color:var(--active); box-shadow:0 0 0 1px var(--active) inset; }
      .panel { border:1px solid var(--line); border-radius:12px; overflow:hidden; background:#0f1730; }
      iframe { width:100%; height:calc(100vh - 240px); min-height:620px; border:0; display:none; }
      iframe.active { display:block; }
      .foot { margin-top:10px; color:var(--muted); font-size:13px; }
      a { color:#93c5fd; }
    
      .guestbook{margin-top:14px;background:var(--panel);border:1px solid #1f2a44;border-radius:12px;padding:14px}
      .guestbook h3{margin:0 0 8px}
      .guestbook textarea{width:100%;min-height:90px;background:#0f1730;border:1px solid #253252;border-radius:8px;color:var(--text);padding:10px}
      .guestbook .row{display:flex;gap:8px;align-items:center;margin-top:8px}
      .guestbook button{background:#2563eb;color:#fff;border:none;border-radius:8px;padding:8px 12px;cursor:pointer}
      .guestbook .hint{color:var(--muted);font-size:12px}
      .guestbook .error{color:#ef4444;font-size:13px;margin-top:6px}
      .comment-list{margin-top:12px;display:grid;gap:8px}
      .comment-item{background:#0f1730;border:1px solid #253252;border-radius:8px;padding:10px}
      .comment-time{color:var(--muted);font-size:12px;margin-top:6px}
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>市場報表中心</h1>
      <div class="sub">用分頁切換不同報表（台股 / 美股 / BTC）</div>
      <div class="sub" id="viewCounter">點閱數：--</div>

      <div class="tabs">
        <button class="tab active" data-target="tw">台股 15 分鐘</button>
        <button class="tab" data-target="us">美股 15 分鐘</button>
        <button class="tab" data-target="btc">BTC 每小時</button>
        <button class="tab" data-target="twnews">台股新聞</button>
        <button class="tab" data-target="usnews">美股新聞</button>
      </div>

      <div class="panel">
        <iframe id="tw" class="active" src="./tw/"></iframe>
        <iframe id="us" src="./us/"></iframe>
        <iframe id="btc" src="./btc-hourly/"></iframe>
        <iframe id="twnews" src="./tw-news/"></iframe>
        <iframe id="usnews" src="./us-news/"></iframe>
      </div>

      <div class="foot">提示：綠色 = 上漲，紅色 = 下跌。</div>
    </div>

    
      <div class="guestbook">
        <h3>留言板</h3>
        <textarea id="guestInput" placeholder="請輸入留言（禁止連結、髒話、程式碼）"></textarea>
        <div class="row">
          <button id="guestSubmit">送出留言</button>
          <span class="hint">每頁獨立留言，儲存在瀏覽器本機</span>
        </div>
        <div id="guestError" class="error"></div>
        <div id="guestList" class="comment-list"></div>
      </div>

    <script>
      // Guestbook (client-side)
      (function(){
        const input = document.getElementById('guestInput');
        const submit = document.getElementById('guestSubmit');
        const errorEl = document.getElementById('guestError');
        const listEl = document.getElementById('guestList');
        if(!input || !submit || !listEl) return;

        const key = `guestbook:${location.pathname}`;
        const bannedWords = [
          'fuck','shit','bitch','asshole','motherfucker','wtf',
          '幹','靠北','靠杯','白癡','智障','垃圾','媽的','操你媽','幹你娘'
        ];
        const urlRegex = /(https?:\/\/|www\.|[a-z0-9.-]+\.(com|net|org|io|dev|app|ai|tw|co))(\/|\s|$)/i;
        const codeRegex = /(<\/?[a-z][^>]*>|`{1,3}|\b(function|const|let|var|class|import|export|return)\b|if\s*\(|for\s*\(|while\s*\(|[{};<>])/i;

        function load(){
          try{return JSON.parse(localStorage.getItem(key)||'[]')}catch{return []}
        }
        function save(items){ localStorage.setItem(key, JSON.stringify(items.slice(0,50))); }
        function esc(s){ return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
        function render(){
          const items = load();
          if(!items.length){ listEl.innerHTML = '<div class="hint">目前尚無留言</div>'; return; }
          listEl.innerHTML = items.map(i => `<div class="comment-item">${esc(i.text)}<div class="comment-time">${i.time}</div></div>`).join('');
        }
        function validate(text){
          const t = text.trim();
          if(t.length < 2) return '留言太短';
          if(t.length > 200) return '留言請勿超過 200 字';
          if(urlRegex.test(t)) return '禁止張貼連結';
          if(codeRegex.test(t)) return '禁止張貼程式碼';
          const lower = t.toLowerCase();
          if(bannedWords.some(w => lower.includes(w))) return '包含不當字詞，請修改';
          return '';
        }

        submit.addEventListener('click', ()=>{
          const text = input.value || '';
          const err = validate(text);
          errorEl.textContent = err;
          if(err) return;
          const items = load();
          items.unshift({ text: text.trim(), time: new Date().toLocaleString('zh-TW', { hour12:false }) });
          save(items);
          input.value = '';
          render();
        });

        render();
      })();

      const pageKey = `views:${location.pathname}`;
      const pageViews = Number(localStorage.getItem(pageKey) || '0') + 1;
      localStorage.setItem(pageKey, String(pageViews));
      const viewCounterEl = document.getElementById('viewCounter');
      if (viewCounterEl) viewCounterEl.textContent = `點閱數：${pageViews}`;

      const tabs = document.querySelectorAll('.tab');
      const frames = { tw: document.getElementById('tw'), us: document.getElementById('us'), btc: document.getElementById('btc'), twnews: document.getElementById('twnews'), usnews: document.getElementById('usnews') };
      let currentTab = 'tw';


      function switchTab(target) {
        currentTab = target;
        tabs.forEach(t => t.classList.toggle('active', t.dataset.target === target));
        Object.entries(frames).forEach(([k, el]) => el.classList.toggle('active', k === target));
      }

      tabs.forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.target)));

      if (location.hash === '#us') switchTab('us');
      else if (location.hash === '#btc') switchTab('btc');
      else if (location.hash === '#twnews') switchTab('twnews');
      else if (location.hash === '#usnews') switchTab('usnews');
      else switchTab('tw');
    </script>
  </body>
</html>
