<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°è‚¡å³æ™‚å ±è¡¨ï¼ˆ15 åˆ†é˜æ›´æ–°ï¼‰</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg: #0b1020;
        --panel: #121a2f;
        --panel-2: #18213a;
        --text: #e6edf3;
        --muted: #9fb0c3;
        --green: #3fb950;
        --red: #f85149;
      }
      * { box-sizing: border-box; }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        margin: 20px;
        background: linear-gradient(180deg, #0b1020 0%, #0a1226 100%);
        color: var(--text);
      }
      .wrap { max-width: 1100px; margin: 0 auto; }
      .top-bar{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:10px}
      .logo{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:10px;border:1px solid #2a3a5e;background:#101a33;color:#dbeafe;font-weight:800;font-size:13px}
      h1 { margin: 0 0 8px; }
      .sub { color: var(--muted); margin-bottom: 14px; }
      .status { display: inline-block; padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 600; background: #253252; color: #c7d5e5; margin-bottom: 16px; }
      .top-tags { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:14px; }
      .nav-item { display:flex; flex-direction:column; gap:4px; align-items:flex-start; }
      .tag { display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid #2a3a5e; color:#cfe2ff; text-decoration:none; font-size:12px; font-weight:700; }
      .tag-sub { color:#8fa3bf; font-size:11px; line-height:1; padding-left:8px; }
      .tag.active { border-color:#60a5fa; background:#1a315f; color:#ffffff; }
      table { width: 100%; border-collapse: collapse; background: var(--panel); border-radius: 12px; overflow: hidden; }
      th, td { padding: 12px; border-bottom: 1px solid #1f2a44; text-align: left; }
      th { background: var(--panel-2); }
      tr:last-child td { border-bottom: none; }
      .up { color: #22c55e; }   /* positive = green */
      .down { color: #ef4444; } /* negative = red */
      .flat { color: var(--muted); }
      .muted { color: var(--muted); }
      .chart-wrap {
        background: var(--panel);
        border: 1px solid #1f2a44;
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 14px;
      }
      .summary {
        margin-top: 14px;
        background: var(--panel);
        border: 1px solid #1f2a44;
        border-radius: 12px;
        padding: 14px;
        line-height: 1.6;
      }

    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="top-bar">
        <div class="logo">ğŸ§­ OpenClaw Market Hub</div>
        <div class="top-tags">
          <div class="nav-item"><a class="tag" href="../">Home</a><span class="tag-sub">Main Portal</span></div>
          <div class="nav-item"><a class="tag active" href="./">å°è‚¡</a><span class="tag-sub">TW Market</span></div>
          <div class="nav-item"><a class="tag" href="../us/">ç¾è‚¡</a><span class="tag-sub">US Market</span></div>
        </div>
      </div>
      <h1>å°è‚¡å³æ™‚å ±è¡¨ï¼ˆ15 åˆ†é˜æ›´æ–°ï¼‰</h1>
      <div class="sub" id="updated">è¼‰å…¥ä¸­...</div>
      <div class="sub" id="viewCounter">é»é–±æ•¸ï¼š--</div>
      <div class="status" id="marketStatus">æª¢æŸ¥äº¤æ˜“æ™‚æ®µä¸­...</div>
      <div class="sub">é¡è‰²è¦å‰‡ï¼š<span class="up">ç¶ è‰² = æ­£å ±é…¬/ä¸Šæ¼²</span>ï¼Œ<span class="down">ç´…è‰² = è² å ±é…¬/ä¸‹è·Œ</span></div>

      <div class="chart-wrap">
        <canvas id="changeChart" height="90"></canvas>
      </div>

      <table>
        <thead>
          <tr>
            <th>è‚¡å</th>
            <th>æ¼²è·Œ</th>
            <th>æ¼²å¹…</th>
            <th>æˆäº¤</th>
            <th>ä»£è™Ÿ</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>

      <div class="summary">
        <div id="summary">è¼‰å…¥æ‘˜è¦ä¸­...</div>
      </div>



    </div>

    <script>

      const pageKey = `views:${location.pathname}`;
      const pageViews = Number(localStorage.getItem(pageKey) || '0') + 1;
      localStorage.setItem(pageKey, String(pageViews));
      const viewCounterEl = document.getElementById('viewCounter');
      if (viewCounterEl) viewCounterEl.textContent = `é»é–±æ•¸ï¼š${pageViews}`;

      function cls(v) {
        if (v > 0) return 'up';
        if (v < 0) return 'down';
        return 'flat';
      }

      function fmt(v, suffix = '') {
        if (v === null || v === undefined || Number.isNaN(v)) return '<span class="muted">N/A</span>';
        return `${v}${suffix}`;
      }

      function fmtSigned(v, suffix = '') {
        if (v === null || v === undefined || Number.isNaN(v)) return '<span class="muted">N/A</span>';
        const sign = v > 0 ? '+' : '';
        return `${sign}${v}${suffix}`;
      }

      function twMarketStatus() {
        const now = new Date();
        const tw = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Taipei' }));
        const day = tw.getDay(); // 0 Sun, 6 Sat
        const minutes = tw.getHours() * 60 + tw.getMinutes();
        const open = 9 * 60;
        const close = 13 * 60 + 30;

        if (day === 0 || day === 6) return 'å°è‚¡ä¼‘å¸‚ï¼ˆé€±æœ«ï¼‰';
        if (minutes >= open && minutes <= close) return 'å°è‚¡äº¤æ˜“ä¸­ï¼ˆ09:00-13:30ï¼‰';
        return 'å°è‚¡éäº¤æ˜“æ™‚æ®µ';
      }

      function renderSummary(items) {
        const valid = items.filter(i => typeof i.changePercent === 'number');
        if (!valid.length) {
          document.getElementById('summary').innerHTML = 'ã€å°è‚¡æ‘˜è¦ã€‘ç›®å‰è³‡æ–™ä¸è¶³ï¼Œå»ºè­°å…ˆè§€å¯Ÿã€‚<br><span class="muted">â€» åƒ…ä¾›åƒè€ƒï¼ŒéæŠ•è³‡å»ºè­°ã€‚</span>';
          return;
        }

        const avg = valid.reduce((a, b) => a + b.changePercent, 0) / valid.length;
        const up = valid.filter(i => i.changePercent > 0).length;
        const down = valid.filter(i => i.changePercent < 0).length;
        const topUp = valid.slice().sort((a, b) => b.changePercent - a.changePercent)[0];
        const topDown = valid.slice().sort((a, b) => a.changePercent - b.changePercent)[0];

        let tone = 'ä¸­æ€§åè§€æœ›';
        let action = 'å»ºè­°åˆ†æ‰¹ã€æ§åˆ¶éƒ¨ä½ï¼Œç­‰å¾…æ–¹å‘æ›´æ˜ç¢ºã€‚';
        if (avg > 0.6 && up > down) {
          tone = 'åå¤š';
          action = 'å¯å„ªå…ˆé—œæ³¨å¼·å‹¢æ¨™çš„ï¼Œæ¡åˆ†æ‰¹å¸ƒå±€ä¸¦è¨­åœåˆ©åœæã€‚';
        } else if (avg < -0.6 && down >= up) {
          tone = 'åç©º';
          action = 'å»ºè­°é™ä½è¿½åƒ¹ï¼Œä¿ç•™ç¾é‡‘ï¼Œç­‰å¾…æ­¢ç©©è¨Šè™Ÿã€‚';
        }

        document.getElementById('summary').innerHTML =
          `ã€å°è‚¡æ‘˜è¦ã€‘æ•´é«”æ°£æ°›ï¼š<b>${tone}</b>ï¼ˆå¹³å‡æ¼²å¹… ${avg.toFixed(2)}% ï¼Œä¸Šæ¼² ${up} æª” / ä¸‹è·Œ ${down} æª”ï¼‰ã€‚<br>` +
          `å¼·å‹¢ï¼š<span class="up">${topUp.label} (${topUp.changePercent}%)</span>ï¼›å¼±å‹¢ï¼š<span class="down">${topDown.label} (${topDown.changePercent}%)</span>ã€‚<br>` +
          `ã€æŠ•è³‡å»ºè­°ã€‘${action}<br><span class="muted">â€» ä»¥ä¸Šç‚ºç¨‹å¼è‡ªå‹•æ‘˜è¦ï¼Œåƒ…ä¾›åƒè€ƒï¼ŒéæŠ•è³‡å»ºè­°ã€‚</span>`;
      }

      function loadData() {
        fetch('./data/latest.json?ts=' + Date.now())
          .catch(() => fetch('../data/latest.json?ts=' + Date.now()))
          .then(r => r.json())
          .then(data => {
            document.getElementById('updated').textContent = `æœ€å¾Œæ›´æ–°ï¼š${data.updatedAt} (${data.timezone})ï½œé é¢æ¯ 60 ç§’æª¢æŸ¥ä¸€æ¬¡æ–°è³‡æ–™`;
            document.getElementById('marketStatus').textContent = twMarketStatus();

            const rows = data.items.map(item => {
              const c = cls(item.change || 0);
              return `
                <tr>
                  <td>${item.label}</td>
                  <td class="${c}">${fmtSigned(item.change)}</td>
                  <td class="${c}">${fmtSigned(item.changePercent, '%')}</td>
                  <td>${fmt(item.price)}</td>
                  <td>${item.symbol}</td>
                </tr>
              `;
            }).join('');
            document.getElementById('rows').innerHTML = rows;

            const labels = data.items.map(i => i.label);
            const vals = data.items.map(i => (typeof i.changePercent === 'number' ? i.changePercent : 0));
            const colors = vals.map(v => v > 0 ? 'rgba(63,185,80,0.8)' : v < 0 ? 'rgba(248,81,73,0.8)' : 'rgba(159,176,195,0.8)');

            renderSummary(data.items || []);

            if (window._changeChart) window._changeChart.destroy();
            window._changeChart = new Chart(document.getElementById('changeChart'), {
              type: 'bar',
              data: { labels, datasets: [{ label: 'æ¼²è·Œå¹… %', data: vals, backgroundColor: colors }] },
              options: {
                responsive: true,
                plugins: { legend: { labels: { color: '#e6edf3' } } },
                scales: {
                  x: { ticks: { color: '#c7d5e5' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                  y: { ticks: { color: '#c7d5e5' }, grid: { color: 'rgba(255,255,255,0.05)' } }
                }
              }
            });
          })
          .catch(err => {
            document.getElementById('updated').textContent = 'è®€å–è³‡æ–™å¤±æ•—';
            console.error(err);
          });
      }

      loadData();
      setInterval(loadData, 60 * 1000);
    </script>
  </body>
</html>
